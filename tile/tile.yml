---
name: splunk-firehose-nozzle
label: Splunk Firehose Nozzle for PCF
description: Forward firehose logs & metrics to Splunk
icon_file: icon.png

# org: test-org                       # Optional
# space: test-space                   # Optional
org_quota: 4096                       # Optional, memory quota in mb
apply_open_security_group: true       # Apply open security group, default: false
allow_paid_service_plans: true        # Allow paid service plans, default: false

stemcell_criteria:
  os: ubuntu-trusty
  requires_cpi: false
  version: '3263'

properties:
- name: author
  type: string
  label: Author
  value: Shubham Jain

forms:
- name: splunk-config
  label: Splunk Settings
  description: Splunk HTTP Event Collector Settings
  markdown: |
    Configure your Splunk HTTP Event Collector 
  properties:
  - name: splunk_host
    type: string
    label: HTTP Event Collector Endpoint URL
    description: HTTP Event Collector endpoint. See https://example.cloud.splunk.com:8088 for an example.
  - name: splunk_token
    type: secret
    label: HTTP Event Collector Token
    description: Splunk HTTP Event Collector token. See http://docs.splunk.com/Documentation/Splunk/latest/Data/UsetheHTTPEventCollector for more information.
  - name: skip_ssl_validation_splunk
    type: boolean
    label: Skip SSL Validation
    default: false
    description: Skip SSL certificate validation for connection to CF. Secure communications will not check SSL certificates against a trusted CA Authority.
  - name: splunk_index
    type: string
    label: Index
    description: The name of the Splunk index that events will be sent to. Warning:-Setting an invalid index will cause events to be lost.
    default: main      

- name: cf-config
  label: Cloud Foundry Settings
  description: Cloud Foundry Connection Settings
  properties:
  - name: api_endpoint
    type: string
    label: API Endpoint
    description: Cloud foundry API endpoint. See https://appseg.syseg.example.cfplatformeng.com for an example. 
  - name: api_user
    type: string
    label: API User
    description: API username
  - name: api_password
    type: secret
    label: API Password
    description: Password for API user
  - name: skip_ssl_validation_cf
    type: boolean
    label: Skip SSL Validation
    default: false
    description: Skip SSL certificate validation for connection to CF. Secure communications will not check SSL certificates against a trusted CA Authority. Do not set to true in production. 
  - name: events
    type: multi_select_options
    label: Event Types
    default: ['HttpStartStop', 'LogMessage', 'ValueMetric', 'CounterEvent', 'Error', 'ContainerMetric']
    options:
      - name: HttpStartStop
        label: HttpStartStop
      - name: LogMessage
        label: LogMessage
      - name: ValueMetric
        label: ValueMetric
      - name: CounterEvent
        label: CounterEvent
      - name: Error
        label: Error
      - name: ContainerMetric
        label: ContainerMetric
    description: Event types to forward to Splunk.     

- name: advanced
  label: Advanced
  description: Advance Nozzle configuration.
  properties: 
  - name: firehose_subscription_id
    type: string
    label: Firehose Subscription ID
    description: Unique subscription ID to nozzle. Firehose balances across socket connections with the same ID. 
    optional: true
  - name: extra_fields
    type: string
    label: Additional Fields
    description: A set of key:value pairs formatted as "key1:value1, key2:value2, key3:value3" that do not occur in the event payload. These fields are added to every event payload for indexing by Splunk and are used to tag all events. 
    optional: true
  - name: add_app_info
    type: boolean
    default: false
    label: Add App Information
    description: Enriches raw data with application metadata, such as application name, space name, org name, etc.
  - name: enable_event_tracing
    type: boolean
    label: Enable Event Tracing
    default: false
    description: Enables data loss tracing.
    

packages:
- name: splunk-firehose-nozzle
  type: app
  label: Splunk-Firehose-Nozzle     
  manifest:
    memory: 512M
    instances: 2
    buildpack: binary_buildpack
    path: ../splunk-firehose-nozzle
    command: ./splunk-firehose-nozzle
    env:
      GOPACKAGENAME: main
      

     
 







